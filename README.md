# Compact parallel hash tables for the GPU (WIP)

## Installation

As this is a header-only library, it suffices to copy the `include` directory.

## Build instructions

This project was developed using GCC 10 and CUDA Toolkit 12.
It uses Thrust and C++20 for convenience/readability. Both could be eliminated.

To compile the tests,
[install Meson and Ninja](https://mesonbuild.com/Getting-meson.html)
and setup a build directory using
```
meson setup build -Dbuildtype=debugoptimized -Dwerror=false
```
In particular, `werror` must be disabled because of some warnings generated in
CUB. The tests can then be run with
```
meson test -C build
```

__Warning:__ current versions of Meson do not properly trigger a rebuild for
nvcc executables if included headers change.
Run
```
meson compile -C build --clean; meson compile -C build
```
to trigger a full rebuild of the tests after modifying the headers.
This should not be necessary for (future) Meson versions > 1.3.1.

The interface of the `tests` executable (built in the build directory) is
automatically generated by [doctest][] and has useful options. For example,
```
./build/tests -s
```
also reports passed tests (useful for debugging).

## Benchmarks

The `benchmarks` folder contains code for benchmark executables, as well as
data generators. Currently very bare-bones: use `generate.py` to generate
numbers saving them to `benchmarks/data/1`. Compile and run the `bench`
executable from the project directory to run a find-or-put benchmark.

Since the Cuckoo find-or-put implementation sorts the input (it has to avoid
duplicate insertions), initial findings show that the Iceberg table outperforms
Cuckoo when the input contains a reasonable number of duplicates. If
duplication is very high, Cuckoo will outperform Iceberg, because of lower
memory use. (Here Iceberg could also benefit from deduplicating the input.)

## Acknowledgements (TODO: expand)

Non-compact parallel bucketed Cuckoo hashing on the GPU is due to [BGHT][].
Iceberg hashing is due to [IcebergHT][].

Parts of the implementation are inspired by [CompactCuckoo][] and [BGHT][].
In particular, the cooperative-group based approach from [BGHT][] is used,
and the default key permutation is (a one-round Feistel function) based on the
hash family in [BGHT][] for comparison purposes.

[BGHT]: https://github.com/owensgroup/BGHT
[CompactCuckoo]: https://github.com/DaanWoltgens/CompactCuckoo
[doctest]: https://github.com/doctest/doctest
[IcebergHT]: https://arxiv.org/abs/2210.04068
